### Возьмите любой демонстрационный DATASET: https://clickhouse.com/docs/en/getting-started/example-datasets.
https://clickhouse.com/docs/ru/getting-started/example-datasets/menus
```bash
wget https://s3.amazonaws.com/menusdata.nypl.org/gzips/2021_08_01_07_01_17_data.tgz
tar xvf 2021_08_01_07_01_17_data.tgz
```
```sql
use s3test;
CREATE TABLE dish
(
    id UInt32,
    name String,
    description String,
    menus_appeared UInt32,
    times_appeared Int32,
    first_appeared UInt16,
    last_appeared UInt16,
    lowest_price Decimal64(3),
    highest_price Decimal64(3)
) ENGINE = MergeTree ORDER BY id;

CREATE TABLE menu
(
    id UInt32,
    name String,
    sponsor String,
    event String,
    venue String,
    place String,
    physical_description String,
    occasion String,
    notes String,
    call_number String,
    keywords String,
    language String,
    date String,
    location String,
    location_type String,
    currency String,
    currency_symbol String,
    status String,
    page_count UInt16,
    dish_count UInt16
) ENGINE = MergeTree ORDER BY id;

CREATE TABLE menu_page
(
    id UInt32,
    menu_id UInt32,
    page_number UInt16,
    image_id String,
    full_height UInt16,
    full_width UInt16,
    uuid UUID
) ENGINE = MergeTree ORDER BY id;

CREATE TABLE menu_item
(
    id UInt32,
    menu_page_id UInt32,
    price Decimal64(3),
    high_price Decimal64(3),
    dish_id UInt32,
    created_at DateTime,
    updated_at DateTime,
    xpos Float64,
    ypos Float64
) ENGINE = MergeTree ORDER BY id;
```
```bash
clickhouse-client -d s3test --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --query "INSERT INTO dish FORMAT CSVWithNames" < Dish.csv
clickhouse-client -d s3test --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --query "INSERT INTO menu FORMAT CSVWithNames" < Menu.csv
clickhouse-client -d s3test --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --query "INSERT INTO menu_page FORMAT CSVWithNames" < MenuPage.csv
clickhouse-client -d s3test --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --date_time_input_format best_effort --query "INSERT INTO menu_item FORMAT CSVWithNames" < MenuItem.csv
```

### Выполните два запроса:
#### Один с условием WHERE, не использующим первичный ключ (например, с фильтрацией по другому столбцу).
```sql
click-01.lan :) select * from menu_item where menu_page_id=1389 and dish_id=1;

Query id: aac104f8-0b00-417f-b1fd-d778904b440c

   ┌─id─┬─menu_page_id─┬─price─┬─high_price─┬─dish_id─┬──────────created_at─┬──────────updated_at─┬─────xpos─┬─────ypos─┐
1. │  1 │         1389 │   0.4 │          0 │       1 │ 2011-03-28 15:00:44 │ 2011-04-19 04:33:15 │ 0.111429 │ 0.254735 │
   └────┴──────────────┴───────┴────────────┴─────────┴─────────────────────┴─────────────────────┴──────────┴──────────┘

1 row in set. Elapsed: 0.058 sec. Processed 1.33 million rows, 5.34 MB (23.19 million rows/s., 92.76 MB/s.)
Peak memory usage: 1.61 MiB.
```

#### Другой с условием WHERE, использующим первичный ключ (например, с фильтрацией по столбцу, являющемуся PK).
```sql
click-01.lan :) select * from menu_item where id=1389

Query id: 7e123d4f-9a73-4701-b8b1-8381cbe6f4f8

   ┌───id─┬─menu_page_id─┬─price─┬─high_price─┬─dish_id─┬──────────created_at─┬──────────updated_at─┬─xpos─┬─────ypos─┐
1. │ 1389 │        12947 │     0 │          0 │     239 │ 2011-04-19 19:34:13 │ 2011-04-19 19:34:13 │ 0.17 │ 0.587388 │
   └──────┴──────────────┴───────┴────────────┴─────────┴─────────────────────┴─────────────────────┴──────┴──────────┘

1 row in set. Elapsed: 0.061 sec. Processed 8.19 thousand rows, 32.77 KB (134.03 thousand rows/s., 536.17 KB/s.)
Peak memory usage: 148.02 KiB.
```
### Сравните текстовые логи запросов. Выделите строки, относящиеся к пробегу основного индекса в логах запросов.
```sql
click-01.lan :) 
SELECT
    ql.query_duration_ms,
    ql.read_rows,
    ql.read_bytes,
    ql.result_rows,
    ql.result_bytes,
    ql.memory_usage,
    ql.query
FROM system.query_log AS ql
WHERE (query_id IN ('7e123d4f-9a73-4701-b8b1-8381cbe6f4f8', 'aac104f8-0b00-417f-b1fd-d778904b440c')) AND (type = 'QueryFinish')

Query id: 59359a4c-4e07-4756-8597-e0000c6b85d0

   ┌─query_duration_ms─┬─read_rows─┬─read_bytes─┬─result_rows─┬─result_bytes─┬─memory_usage─┬─query──────────────────────────────────────────────────────────┐
1. │                42 │      8192 │      32772 │           1 │         1204 │       151572 │ select * from menu_item where id=1389                          │
2. │                57 │   1334792 │    5339947 │           1 │         1204 │      1691584 │ select * from menu_item where menu_page_id=1389 and dish_id=1; │
   └───────────────────┴───────────┴────────────┴─────────────┴──────────────┴──────────────┴────────────────────────────────────────────────────────────────┘

2 rows in set. Elapsed: 0.074 sec. Processed 16.68 thousand rows, 750.79 KB (223.98 thousand rows/s., 10.08 MB/s.)
Peak memory usage: 5.41 MiB.
```
Поле `read_rows` показывает сколько строк прочитано сервером, для того, чтобы найти строку из предиката. В случае с поиском по ключу прочитана одна гранула, в другом случае прочитано гораздо больше данных.


### Используйте команду EXPLAIN для анализа выполнения запросов, покажите использование индекса в выводе.
```sql
click-01.lan :) explain select * from menu_item where menu_page_id=1389 and dish_id=1;

Query id: 0406db95-e586-4c79-9cb1-77c9b2af0abf

   ┌─explain────────────────────────────────────────────────────────────┐
1. │ Expression ((Project names + Projection))                          │
2. │   Expression ((WHERE + Change column names to column identifiers)) │
3. │     ReadFromMergeTree (s3test.menu_item)                           │
   └────────────────────────────────────────────────────────────────────┘

3 rows in set. Elapsed: 0.009 sec.
```
```sql
click-01.lan :) explain select * from menu_item where id=1389

Query id: 87f91f4a-6d02-4741-b7ab-eedfbad2f25e

   ┌─explain────────────────────────────────────────────────────────────┐
1. │ Expression ((Project names + Projection))                          │
2. │   Expression ((WHERE + Change column names to column identifiers)) │
3. │     ReadFromMergeTree (s3test.menu_item)                           │
   └────────────────────────────────────────────────────────────────────┘

3 rows in set. Elapsed: 0.027 sec.
```
В данном случае план запросов одинаков, возможно, по причине того, что все данные поместились в кэш.
