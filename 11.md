## Мутации данных

### Создание таблицы
```sql
click-01.lan :) CREATE TABLE default.user_activity
(
    user_id UInt32,
    activity_type String,
    activity_date DateTime DEFAULT now()
)
ENGINE = MergeTree
ORDER BY activity_date
PARTITION BY activity_date

Query id: edc95ee2-84e8-4101-919e-1994e51903b5

Ok.

0 rows in set. Elapsed: 0.076 sec.
```
### Заполнение таблицы
```sql
INSERT INTO
    default.user_activity
VALUES
    (1, 'login', '2025-09-01 10:00:00')
    ,(2, 'logout', '2025-09-02')
    ,(3, 'purchase', '2025-09-03')
    ,(1, 'logout', '2025-09-01 18:00:00')
    ,(2, 'purchase', '2025-09-04 15:00:00')
    ;

Query id: e2981bc0-573a-4721-b650-52aabfa1bb13

Ok.

5 rows in set. Elapsed: 0.081 sec.
```

### Выполнение мутаций
Выполните мутацию для изменения типа активности у пользователя
```sql
click-01.lan :)
ALTER TABLE default.user_activity
(UPDATE activity_type = 'online'
WHERE activity_type = 'login')

Query id: 17fba022-a82c-4a42-a251-3e58e5c39e59

Ok.

0 rows in set. Elapsed: 0.042 sec.
```

### Проверка результатов
Напишите запрос для проверки изменений в таблице user_activity. Убедитесь, что тип активности у пользователей изменился. Приложите логи отслеживания мутаций в системной таблице.
```sql
click-01.lan :)
SELECT *
FROM default.user_activity
WHERE activity_type = 'online'

Query id: 8dabac94-c6da-4c36-87a8-c611d9b9bfec

   ┌─user_id─┬─activity_type─┬───────activity_date─┐
1. │       1 │ online        │ 2025-09-01 10:00:00 │
   └─────────┴───────────────┴─────────────────────┘

1 row in set. Elapsed: 0.054 sec.
```
```sql
click-01.lan :)
SELECT *
FROM system.mutations

Query id: 5c0621ac-36fa-41a6-a9cc-598b9ef65368

Row 1:
──────
database:                    default
table:                       user_activity
mutation_id:                 mutation_6.txt
command:                     (UPDATE activity_type = 'online' WHERE activity_type = 'login')
create_time:                 2025-10-29 13:11:28
block_numbers.partition_id:  ['']
block_numbers.number:        [6]
parts_to_do_names:           []
parts_to_do:                 0
is_done:                     1
is_killed:                   0
latest_failed_part:
latest_fail_time:            1970-01-01 00:00:00
latest_fail_reason:
latest_fail_error_code_name:

1 row in set. Elapsed: 0.050 sec.

```
```bash
@click-01:~$ sudo cat /var/lib/clickhouse/store/c1e/c1efd399-6ac4-4932-bf99-170fed3b69a2/mutation_6.txt
format version: 1
create time: 2025-10-29 13:11:28
commands: (UPDATE activity_type = \'online\' WHERE activity_type = \'login\')
```

### Манипуляции с партициями
Удалите партицию за определённый месяц.
На текущем наборе данных удалим данные за день, поскольку месяц в дате одинаков во всей таблице.
```sql
click-01.lan :) select partition, name, partition_id, active from system.parts where table = 'user_activity'

Query id: 4461af33-9344-43ec-8da2-e6b5e95916b1

   ┌─partition───────────┬─name───────────────┬─partition_id─┬─active─┐
1. │ 2025-09-01 10:00:00 │ 1756720800_1_1_0_6 │ 1756720800   │      1 │
2. │ 2025-09-01 18:00:00 │ 1756749600_4_4_0_6 │ 1756749600   │      1 │
3. │ 2025-09-02 00:00:00 │ 1756771200_2_2_0_6 │ 1756771200   │      1 │
4. │ 2025-09-03 00:00:00 │ 1756857600_3_3_0_6 │ 1756857600   │      1 │
5. │ 2025-09-04 15:00:00 │ 1756998000_5_5_0_6 │ 1756998000   │      1 │
   └─────────────────────┴────────────────────┴──────────────┴────────┘

5 rows in set. Elapsed: 0.005 sec.
```
```sql
click-01.lan :) ALTER TABLE default.user_activity DROP PARTITION ID '1756998000'

Query id: 8a489bf9-91b7-4adf-bbea-c6baae3b9867

Ok.

0 rows in set. Elapsed: 0.012 sec.
```

### Проверка состояния таблицы
Проверьте текущее состояние таблицы после удаления партиции. Убедитесь, что данные за указанный день были удалены.
```sql
click-01.lan :) select * from default.user_activity WHERE day(activity_date) = 4

Query id: e73368a2-de3a-49f0-a51a-91693a55f0d5

Ok.

0 rows in set. Elapsed: 0.032 sec.
```
