#### Создание таблицы
```sql
wsl-ubuntu :)
CREATE TABLE default.sales
(
    `id` UInt32,
    `product_id` UInt32,
    `quantity` UInt32,
    `price` Float32,
    `sale_date` DateTime
)
ENGINE = MergeTree
ORDER BY (id, product_id)

Query id: 8a009976-1f6e-42a5-a9c4-b0c8098fd480

Ok.

0 rows in set. Elapsed: 0.007 sec.
```

##### Заполните таблицу тестовыми данными
```sql
wsl-ubuntu :)
INSERT INTO sales SELECT
    number AS id,
    round(randUniform(1, 10)) AS product_id,
    round(randUniform(1, 100)) AS quantity,
    round(randUniform(1, 100), 2) AS price,
    now() - (round(randUniform(1, 20)) * 36000) AS sale_date
FROM numbers(1, 12345) AS n

Query id: 213380b7-3f39-464d-95d0-601a1a44dc00

Ok.

0 rows in set. Elapsed: 0.010 sec. Processed 12.35 thousand rows, 98.76 KB (1.22 million rows/s., 9.74 MB/s.)
Peak memory usage: 3.57 MiB.
```

#### Создание проекции
```sql
wsl-ubuntu :)
ALTER TABLE sales
    (ADD PROJECTION IF NOT EXISTS sales_projection
    (
        SELECT
            sum(quantity),
            sum(quantity * price)
        GROUP BY product_id
    ))

Query id: 70269edd-f5e5-4da3-a411-fa6179c12517

Ok.

0 rows in set. Elapsed: 0.012 sec.

wsl-ubuntu :)
ALTER TABLE sales
    (MATERIALIZE PROJECTION sales_projection)

Query id: 9543690d-b347-46b1-8671-d31580ecb39a

Ok.

0 rows in set. Elapsed: 0.005 sec.
```

#### Создание материализованного представления
```sql
wsl-ubuntu :)
CREATE TABLE default.sales_totals
(
    `product_id` UInt32,
    `total_quantity` UInt32,
    `total_sales` Float32
)
ENGINE = SummingMergeTree
ORDER BY product_id

Query id: b75d4063-95e7-41f4-9d17-007bf5c84b7f

Ok.

0 rows in set. Elapsed: 0.011 sec.

wsl-ubuntu :)
CREATE MATERIALIZED VIEW sales_mv TO sales_totals
AS SELECT
    product_id,
    sum(quantity) AS total_quantity,
    sum(quantity * price) AS total_sales
FROM sales
GROUP BY product_id

Query id: a56e3d6d-7c78-4809-aba0-d75e351cfd9a

Ok.

0 rows in set. Elapsed: 0.007 sec.


```

#### Напишите запрос, который извлекает данные из проекции sales_projection
```sql
wsl-ubuntu :)
SELECT
    product_id,
    sum(quantity),
    sum(quantity * price)
FROM sales
GROUP BY product_id
SETTINGS force_optimize_projection = 1

Query id: 774996c6-d10b-4705-af43-a5cff41fa5d1

    ┌─product_id─┬─sum(quantity)─┬─sum(multiply⋯ty, price))─┐
 1. │          4 │        487299 │       32437061.108184934 │
 2. │          3 │        484442 │        32555934.16038263 │
 3. │          2 │        493204 │       32986397.473976374 │
 4. │          5 │        484599 │       32409213.870596766 │
 5. │          1 │        236217 │       15567776.350075483 │
 6. │          6 │        481787 │        31981101.03888583 │
 7. │          7 │        489785 │        32701143.74506831 │
 8. │          9 │        487335 │       32605046.759943962 │
 9. │          8 │        477509 │        31797860.32181096 │
10. │         10 │        244623 │       16272563.180882692 │
    └────────────┴───────────────┴──────────────────────────┘

10 rows in set. Elapsed: 0.007 sec.

```

#### Напишите запрос, который извлекает данные из материализованного представления sales_mv
```sql
wsl-ubuntu :)
SELECT
    product_id,
    total_quantity,
    total_sales
FROM sales_mv

Query id: 2519b931-615b-49d9-81b8-cee8918dccf3

    ┌─product_id─┬─total_quantity─┬─total_sales─┐
 1. │          1 │         236217 │    15567776 │
 2. │          2 │         493204 │    32986398 │
 3. │          3 │         484442 │    32555934 │
 4. │          4 │         487299 │    32437062 │
 5. │          5 │         484599 │    32409214 │
 6. │          6 │         481787 │    31981102 │
 7. │          7 │         489785 │    32701144 │
 8. │          8 │         477509 │    31797860 │
 9. │          9 │         487335 │    32605046 │
10. │         10 │         244623 │    16272563 │
    └────────────┴────────────────┴─────────────┘

10 rows in set. Elapsed: 0.003 sec.

```

### Сравнение производительности

#### запрос к таблице sales
```sql
wsl-ubuntu :)
SELECT
    product_id,
    sum(quantity) AS total_quantity,
    sum(quantity * price) AS total_sales
FROM sales
GROUP BY product_id

Query id: da420dbc-5a73-4ad4-a044-c0f796dade94

    ┌─product_id─┬─total_quantity─┬────────total_sales─┐
 1. │          4 │         487299 │ 32437061.108184934 │
 2. │          3 │         484442 │  32555934.16038263 │
 3. │          2 │         493204 │ 32986397.473976374 │
 4. │          5 │         484599 │ 32409213.870596766 │
 5. │          1 │         236217 │ 15567776.350075483 │
 6. │          6 │         481787 │  31981101.03888583 │
 7. │          7 │         489785 │  32701143.74506831 │
 8. │          9 │         487335 │ 32605046.759943962 │
 9. │          8 │         477509 │  31797860.32181096 │
10. │         10 │         244623 │ 16272563.180882692 │
    └────────────┴────────────────┴────────────────────┘

10 rows in set. Elapsed: 0.052 sec. Processed 86.42 thousand rows, 1.04 MB (1.65 million rows/s., 19.80 MB/s.)
Peak memory usage: 69.71 KiB.
```

#### запрос к проекции
```sql
wsl-ubuntu :)
SELECT
    product_id,
    sum(quantity),
    sum(quantity * price)
FROM sales
GROUP BY product_id
SETTINGS force_optimize_projection = 1

Query id: 774996c6-d10b-4705-af43-a5cff41fa5d1

    ┌─product_id─┬─sum(quantity)─┬─sum(multiply⋯ty, price))─┐
 1. │          4 │        487299 │       32437061.108184934 │
 2. │          3 │        484442 │        32555934.16038263 │
 3. │          2 │        493204 │       32986397.473976374 │
 4. │          5 │        484599 │       32409213.870596766 │
 5. │          1 │        236217 │       15567776.350075483 │
 6. │          6 │        481787 │        31981101.03888583 │
 7. │          7 │        489785 │        32701143.74506831 │
 8. │          9 │        487335 │       32605046.759943962 │
 9. │          8 │        477509 │        31797860.32181096 │
10. │         10 │        244623 │       16272563.180882692 │
    └────────────┴───────────────┴──────────────────────────┘

10 rows in set. Elapsed: 0.007 sec.
```

#### запрос к материалиазованному представлению
```sql
wsl-ubuntu :)
SELECT
    product_id,
    total_quantity,
    total_sales
FROM sales_mv

Query id: ebf06bca-49b0-439b-ab37-54b8ec4b011f

    ┌─product_id─┬─total_quantity─┬─total_sales─┐
 1. │          1 │         236217 │    15567776 │
 2. │          2 │         493204 │    32986398 │
 3. │          3 │         484442 │    32555934 │
 4. │          4 │         487299 │    32437062 │
 5. │          5 │         484599 │    32409214 │
 6. │          6 │         481787 │    31981102 │
 7. │          7 │         489785 │    32701144 │
 8. │          8 │         477509 │    31797860 │
 9. │          9 │         487335 │    32605046 │
10. │         10 │         244623 │    16272563 │
    └────────────┴────────────────┴─────────────┘

10 rows in set. Elapsed: 0.003 sec.
```

Вывод: быстрее всего отрабатывает запрос к материализованному представлению - 0.003 секунды, немного дольше - к проекции - 0.007 секунд, дольше всего к исходной таблице - 0.052 секунды.
